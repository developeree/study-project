<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="sojuSql">

	<!-- 글목록 갯수구하기 -->
	<select id="count" resultType="java.lang.Integer" parameterType="java.util.Map">
		SELECT COUNT(*)
		FROM soju
		WHERE 1 = 1
	</select>
	
	<!-- 목록 SELECT -->
	<select id="selectSojuList" resultType="com.study_project.web.soju.model.Soju" parameterType="java.util.Map">
		SELECT 
			idx,
			title,
			price,
			company,
			tumbnail,
			comment_count
		FROM
			soju
		WHERE 
			1 = 1
		<if test="searchCol != null">
			AND ${searchCol} LIKE CONCAT('%',#{searchVal},'%')
		</if>
		ORDER BY idx asc
		LIMIT #{pageSize} OFFSET #{pageNo}
	</select>
	<!-- 글쓰기 -->
	<insert id="insertSoju" parameterType="com.study_project.web.soju.model.Soju" useGeneratedKeys="true" keyProperty="idx">
		INSERT INTO soju
			(
				title,
				content,
				price,
				create_date,
				edit_date,
				area,
				ad,
				company
			)
		VALUES
			(
				#{title},
				#{content},
				#{price},
				CURRENT_TIMESTAMP,
				NOW(),
				#{area},
				#{ad},
				#{company}
			)
	</insert>
	
	<!-- 상세보기 -->
	<select id="getSoju" resultType="com.study_project.web.soju.model.Soju" parameterType="java.lang.Integer">
		SELECT
			idx,
			title,
			content,
			price,
			create_date,
			edit_date,
			area,
			tumbnail,
			ad,
			comment_count,
			company
		FROM
			soju
		WHERE
			idx = #{idx}
	</select>
	
	<!-- 글수정 -->
	<update id="updateSoju" parameterType="com.study_project.web.soju.model.Soju">
		UPDATE soju
		SET
			title = #{title},
			content = #{content},
			price = #{price},
			edit_date = NOW(),
			area = #{area},
			ad = #{ad},
			company = #{company}
		WHERE
			idx = #{idx}
	</update>
	
	<!-- 글삭제 -->
	<delete id="deleteSoju" parameterType="java.lang.Integer">
		DELETE FROM soju
		WHERE idx = #{idx}
	</delete>
</mapper>